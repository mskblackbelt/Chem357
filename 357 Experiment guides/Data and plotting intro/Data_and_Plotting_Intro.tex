\documentclass[nobib,nofonts,nols,nohyper]{tufte-handout}
\RequirePackage[cache=false]{minted}
\input{header.tex}
\usepackage{menukeys}
\tcbuselibrary{minted}

\title{Introduction to Data Analysis and Plotting with \\ Microsoft Excel}

\author{Dustin Wheeler}

\begin{document}

\maketitle

\begin{abstract}
	\noindent
	The goal of this exercise is to familiarize the student with basic data manipulation and plotting using Microsoft Excel 2016. 
	Many of the concepts are general and can be translated to other software applications. 
	By the end of this exercise, you should be able to 
	\begin{itemize}
		\item perform basic manipulations on data columns (formatting, transformations) 
		\item perform simple mathematical operations over a column of data 
		\item plot columns of data in a clear and visually pleasing manner
		\item perform simple statistical operations on a set of data
		\item get a line-of-best-fit for multiple datasets
		\item import data from plain text files (CSV, TSV, DAT, etc.), like those created by many spectrometers and logging instruments
	\end{itemize}
\end{abstract}

\section{Introduction} % (fold)
\label{sec:intro}

Why do we plot data? Edward Tufte may have said it best:

\begin{quote}
	At their best, graphics are instruments for reasoning about quantitative information. 
	Often the most effective way to describe, explore, and summarize a set of numbers---even a very large set---is to look at pictures of those numbers.
\end{quote}
% section intro (end)

\section{A Little Bit About Plots} % (fold)
\label{sec:a-little-bit-about-plots}

Plots (also called graphs or charts, though these are not \emph{quite} the same thing) come in a variety of styles. 
The can be used to explore data as your are performing analyses or to convey results to a reader as part of a report. 
There are a variety of ``standard'' types which should cover your needs in this course. 
The main types we will use are:

\begin{description}
	\item[Scatter plot] Used to show correlation between two variables, each point generally represents an \textbf{independent} measurement. 
	
	Points are not \textbf{connected} by lines, lines are instead used to represent a mathematical model fitting the data.
	
	\item[Line graph] Indicates continuity in the \( x \) dimension, often suggests a single collection session for all data on the ``line'' (\emph{e.g.,} a UV-Vis or NMR spectrum).
	Individual points are generally not shown.  
	Lines should never be smoothed (or ``splined''), as this treatment no longer accurately represents the data. 
	
	Really, a line graph is just a special case of a scatter plot where the independent variable is continuous. 

	\item[Histogram] Represents the distribution of data in a series of ``bins'', shows the frequency of a measured event. 
	Closely related to density plots. 
\end{description}

Here are the important parts of a plot, along with a brief description and guidelines for formatting.

\begin{description}
	\item[Title] Should be descriptive and represent \emph{all} data in the plot.
	\item[Axes] Should be clearly labeled (category, units, tick numbers). 
	Should have an appropriate range (from slightly less than your minimum value to slightly more than your maximum value).
	\item[Fit line] Should cover the whole spread of the data, but should not predict beyond the data range (you don't know anything about measurements in that region).
	\item[Legend] Should clearly show which set of data is which, trend lines should clearly correlate to a given data set.
\end{description}

% section a-little-bit-about-plots (end)

\section{Basic Plotting and Linear Fits} % (fold)
\label{basic-plotting-and-linear-fits}

Your first task is to take the data in the file \texttt{data.txt} and import it into a new Excel workbook. 
Begin by downloading the input files from the \Verb{Plotting} folder on Blackboard. 
This folder contains a few datasets in some plain-text formats. 
The file extension doesn't always tell you what type of information is in a file and can sometimes
lead you astray. 
For this exercise, the file \texttt{data.txt} contains a set of ``tab-delimited'' data, meaning that the values in a row are separated by tab characters. 
Another common format is ``comma-delimited'' or ``comma-separated'' data, such as the dataset in \Verb{anscombe.csv}. 
You will find that different instruments have different defaults for exporting data, but these two are the most common.

Open up a new Excel workbook and save it to a safe location (if this is a lab computer, your best bet is to save directly to your own flash drive). 
In the workbook, pull in the data from \Verb{data.txt} by selecting the \textbf{Data} tab in the Ribbon and clicking on \textbf{From Text} (see \cref{fig:import_data}). 
On a Mac, you can also select \textbf{File → Import} in the menu bar.

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.9\textwidth]{images/import_data.png}
	\caption{How to import data in Excel 2016.}
	\label{fig:import_data}
\end{figure}

Follow the prompts to import data which is tab-separated into the first rows in your spreadsheet. 
You should end up with two columns of data with 21 data points in each column. 
Once you have the data columns, create a new scatter plot from the data. 
This is done by clicking on the \textbf{Insert} tab and selecting the correct type of chart.\footnote{
	\emph{n.b.:}   Excel is designed primarily as a tool for finance and business  operations. 
	The default settings for plots are often inappropriate for  scientific plots, and the \textbf{Recommended Charts} button will rarely give  you an appropriate suggestion for a plot.} 
When you insert a new plot, it appears as a floating object in your current sheet. 
While you are exploring data, this is fine, but you'll probably want to move these objects to their own sheet when you really start customizing their appearance. 
You can do this by right-clicking on the plot background and selecting \textbf{Move Chart…}. 
This will bring up a window where you can choose to move the chart to its own new sheet or as an object in another
existing sheet (shown in \cref{fig:move_chart}).

\begin{figure}[ht]
	\centering
	\includegraphics[width=0.9\textwidth]{images/move_chart.png}
	\caption{Moving a chart to a new location.}
	\label{fig:move_chart}
\end{figure}

Move the chart to a new sheet (name the sheet ``X vs. Y'') and fill in the fundamental plot items (descriptive title, axes title, etc.). 
Once this is complete, remove any unnecessary ``chart junk''. 
This includes things like background shading (Excel has gotten much better at this over the years), grid lines (only needed if you're trying to manually read data off the chart), and the border surrounding the full plot area (should only need axes to indicate the origin or provide an anchor for tick marks). 
If there is a legend (useful when there are multiple datasets present), it should be a part of the plot area. 
Don't waste valuable area on something like a legend than can be nestled in one of the empty parts of your plot. 
Finally, while color seems like a nice feature, plots shouldn't rely on color to convey meaning. 
There's always a chance that readers won't have access to color printouts, or that the reader may be colorblind. 
To keep plots accessible, use symbols, line weights, and dashing to differentiate your datasets. 
The lesson to learn from this paragraph is that simplicity is key to conveying your message. 
The sole purpose of your figures are to help the reader understand the message.
Anything that distracts from that is harmful to your cause.

Now that the plot has been cleaned up, adjust the axes to best represent the data and insert a trendline (right-click an empty spot in the plot area, select \textbf{Add Trendline…}). 
A linear fit should be sufficient for this data. 
In the format options for the trendline, display the equation and \( R^2 \) value on the plot. 
Move the text box so it doesn't obscure any of the plot data.

% section basic-plotting-and-linear-fits (end)

\subsection{The \Verb{LINEST} Function} % (fold)
\label{the-linest-function}

Now that you have a trendline, it's time to get some information about it. 
Excel has a function called \href{https://support.office.com/en-us/article/LINEST-function-84D7D0D9-6E50-4101-977A-FA7ABF772B6D}{\Verb{LINEST}},
which calculates descriptive statistics on a line using a linear least-squares method to find the best fit. 
Examples can be seen on the linked page, but we will run through the simplest example, a straight line.

Return to your data spreadsheet and highlight a \( 2 \times 5  \) grid of cells (the cells directly under or adjacent to your dataset will do). 
Begin typing the following (your keystrokes will automatically go into the upper left cell):

\tcbset{
	left=5mm,
	colback=Blue!4!white, 
	colframe=Blue!85!black,
	listing engine=minted,
	minted style=tango
}
\begin{tcblisting}{listing only,
	minted language=vbscript}
	=linest(
\end{tcblisting}

Excel will pop up a hint telling you what information needs to be entered next. 
The first range should be your \( y \)-values (cells \textbf{B2} through \textbf{B22}), the second range is your \( x \)-values (\textbf{A2} through \textbf{A22}).
The third and fourth arguments are optional. 
Setting the third argument to \Verb{TRUE} will tell the function to calculate a \( y \)-intercept value, while an entry of \Verb{FALSE} will set the intercept equal to zero. 
The fourth argument toggles additional regression statistics using \Verb{TRUE} or \Verb{FALSE}. 
These help you to see how ``good'' the returned fit is. 
Please read the help page to learn what statistics are returned in which cell. 
When you have finished entering your data into the cell, press \keys{Shift + Ctrl + Enter} to tell Excel to calculate all data in the array. 
Note that the numbers in the first row of the array correspond to the slope and intercept of the trendline in your plot.

% section the-linest-function (end)

\section{Anscombe's Quartet} % (fold)
\label{anscombes-quartet}

Repeat the process of importing data with the file \Verb{anscombe.csv}. 
You will need to change the delimiter to a comma for this file. 
This time, import the data into a new sheet called \textbf{Anscombe}. 
You should see 8 columns of data, \emph{x1--x4} and \emph{y1--y4}. 
Begin by calculating \Verb{LINEST} arrays for each \emph{x/y} pair. 
For clarity, you should label each array using a cell just above the array, as shown in \cref{fig:linest_label}.

\begin{figure}[ht]
	\centering
	\includegraphics{images/linest_label.png}
	\caption{A \Verb{LINEST} array with a formatted label cell above it}
	\label{fig:linest_label}
\end{figure}

Once you have four arrays, compare the values… do you notice anything odd? 
Remember, the top two cells represent the slope and intercept of a line of best fit for the data. 
It might help to format the cells to only display three decimal places (highlight the cells, right-click, \textbf{Format Cells…}, then select 3 decimal places under the \textbf{Number} data type).

Clearly, the data sets are different… so what's going on? 
To learn more, plot each of the datasets in a separate plot. 
Discuss your observations with your lab partner, and figure out the best way to deal with information like this. 

The key takeaway from this exercise is that you should always plot your data, even if it's only a quick glance on
the side of your spreadsheet! 
This data was taken from \href{https://doi.org/10.1080/00031305.1973.10478966}{an article written by F.J. Anscombe in 1973} arguing for the necessity of graphs in statistical analysis.

% section anscombes-quartet (end)

\section{Column Manipulation and Plotting Spectra} % (fold)
\label{column-manipulation-and-plotting-spectra}

From the set of input files you downloaded from Blackboard, open the file labeled \Verb{FTIR_UVVis_template.xltx}. 
Copy the data from the FTIR sheet and paste it into your plotting document in a new sheet called ``FTIR''. 
Once you have this data in a sheet, insert a new row at the top of the data (for column labels) and a new column between columns \textbf{A} and \textbf{B}. 
Label column \textbf{A} ``Wavenumber (\si{\cm^{-1}})'', column \textbf{B} as ``Wavelength (\si{\um})'', column \textbf{C} as ``\% Transmission'', and column \textbf{D} as ``Absorbance''.\footnote{What are the relevant units for \%T and A?}

You will be automatically filling in values for columns \textbf{B} and \textbf{D} based on the data in \textbf{A} and \textbf{C}. 
Click on cell \textbf{B2} and enter the following:

\begin{tcblisting}{listing only,
minted language=vbscript}
=1/(A2/10^(-2))*10^(6)
\end{tcblisting}

This is a conversion from wavenumber to wavelength. 
You should be able to derive this equation quickly on your own…

Click on cell \textbf{B2}. 
You can perform this next step in two ways. 
First, you can copy cell \textbf{B2}, select the the whole range of cells below it (through \textbf{B1766}), and paste.\footnote{a range of cells can be selected by clicking the first cell, holding down the \keys{Shift} key, and then clicking the last cell.} 
This will fill the range with an incremented version of the equation you just typed (\textbf{A2} will be incremented in each cell until it reaches \textbf{A1766}). 
You can also select cell \textbf{B2} and click and hold on the small square that appears at the bottom right corner of the cell. 
While holding down the mouse button, drag your selection down until you reach the bottom of the range (\textbf{B1766}). 
For short selections (fewer than 50 cells) this can be convenient. 
For larger selections, it is often easier to select the range using the \keys{Shift} key.

Perform the same sets to take the values in column \textbf{C} and transform them into Absorbance values in column \textbf{D}. 
Remember that Absorbance is \(\log_{10}(1/T)\) while Transmittance is \(I / I_0\).

Once you have created columns \textbf{B} and \textbf{D}, create two plots, one plotting columns \textbf{A} vs. \textbf{C}, the second plotting \textbf{B} vs. \textbf{D}. 
Because these are spectra (data collected in a single experiment), it is appropriate to plot them as line plots, \emph{without} plotting the individual points. 
Make sure that your plot reflects this. 
You will also need to decrease the thickness of the default line so that fine features are not obscured by poor plot formatting (as I said, Excel's defaults are often inappropriate). 
Make sure your plots are labeled in all the appropriate locations and that your spectra look clean and presentable.

Congratulations, you have the basics of plotting and calculation using Excel! 
You are expected to take this information and build upon it as you write reports through the semester. 
All of these techniques can be translated to other applications, some of which might be more appropriate for the type of research being performed in a research group. 
You should be able to transfer your basic skills to any other software with ease, and the tips on presentability are universally applicable.

%section column-manipulation-and-plotting-spectra (end)

\section{Alternative Software} % (fold)
\label{alternative-software}

Excel may be the most common piece of software for plotting, but that doesn't mean it's the best. 
You may find that you desire more control over your plots, or a simpler interface, or the ability to manipulate your data in other manners. 
If so, you might want to look at the following applications. 
Some are free, some are available through a CUNY site license, and some are paid (and expensive). 
This list is not comprehensive, but it does give you an idea of the variety available to you should you be interested.

\begin{description}
	\item [\href{https://www.libreoffice.org/discover/calc/}{LibreOffice Calc} (Free)] Part of the free and open source LibreOffice suite, designed as a full featured alternative to Microsoft Office.
	
	\url{https://www.libreoffice.org/discover/calc/}
	
	\item [\href{https://www.apple.com/numbers/}{Apple Numbers} (Free)] Apple's entry into the spreadsheet category. 
	Works nearly as well as Excel, cleaner interface, but macOS/iOS-only and can't always do some of the more advanced statistics.
	
	\url{https://www.apple.com/numbers/}
	
	\item[\href{https://docs.google.com/spreadsheets/}{Google Sheets} (Free)] Like all Google products, this is web-only (no offline data analysis here!). 
	Designed to be a clone of Excel.
	
	\url{https://docs.google.com/spreadsheets/}
	
	\item[\href{https://www.graphpad.com}{GraphPad Prism} (CUNY site license available)] Statistical analysis software for Windows and macOS. 
	Capable of repeated analysis on huge datasets of life/social science data. 
	Falls short in spectral analysis tools.
	
	\url{https://www.graphpad.com}
	
	\item[\href{https://www.originlab.com}{Origin by OriginLab} (no site license available)] Professional data analysis and plotting software for scientists and engineers. 
	Heavy focus on physical sciences and engineering. 
	Only available on Windows. 
	
	\url{https://www.originlab.com}
	
	\item[\href{https://www.wavemetrics.com/products/igorpro}{Igor Pro by WaveMetrics} (no site license available)] Very similar to Origin, but available for macOS and Windows.
	
	\url{https://www.wavemetrics.com/products/igorpro}
	
	\item[\href{http://www.wolfram.com/mathematica/}{Mathematica} (site license), 
	\href{https://www.mathworks.com/products/matlab.html}{Matlab} (site license), 
	\href{https://jupyter.org}{JupyterLab} (free)] 
	These are really programming environments, though they are designed for use by scientists. Mathematica and Matlab are commercial products, while Jupyter is an open-source option that uses the \href{https://julialang.org}{JUlia},
  \href{https://www.python.org}{PYThon}, and \href{https://www.r-project.org}{R} languages. 
	They all have entry-output interfaces so that live interaction can be done with data. 
	While the learning curve is steep, the payout for learning a programming language will last a lifetime. 
	We will be using the Python language later in the semester for some computational chemistry work.
	
	\url{http://www.wolfram.com/mathematica/}
	
	\url{https://www.mathworks.com/products/matlab.html}
	
	\url{https://jupyter.org}
	
\end{description}

\end{document}
